import{C as f,g as T,o as y,c as w,a as o,b as e,w as t,T as R,J as U,h as g,F as P,G as D,s as x,H as $,K as I,n as S,p as h,E as d,q as j,L as A,y as G,m as H,I as J,A as K,k as L,j as M,D as O}from"./index-95e35314.js";/* empty css                 *//* empty css                *//* empty css                  */const Q={style:{margin:"30px 20px"}},W={key:0,style:{"text-align":"center",margin:"0 20px",height:"100%"}},X=o("div",{style:{"margin-top":"80px"}},[o("div",{style:{"font-size":"25px","font-weight":"bold"}},"重置密码"),o("div",{style:{"font-size":"14px",color:"grey"}},"请输入需要重置密码的电子邮件地址")],-1),Y={style:{"margin-top":"50px"}},Z={style:{"margin-top":"70px"}},ee={key:0,style:{"text-align":"center",margin:"0 20px",height:"100%"}},te=o("div",{style:{"margin-top":"80px"}},[o("div",{style:{"font-size":"25px","font-weight":"bold"}},"重置密码"),o("div",{style:{"font-size":"14px",color:"grey"}},"请填写您的新密码，务必牢记，防止丢失")],-1),ae={style:{"margin-top":"50px"}},le={style:{"margin-top":"70px"}},pe={__name:"ForgetPage",setup(se){const p=f(0),l=T({email:"",code:"",password:"",password_repeat:""}),V={email:[{required:!0,message:"请输入邮件地址",trigger:"blur"},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}],code:[{required:!0,message:"请输入获取的验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:16,message:"密码的长度必须在6-16个字符之间",trigger:["blur","change"]}],password_repeat:[{validator:(s,a,i)=>{a===""?i(new Error("请再次输入密码")):a!==l.password?i(new Error("两次输入的密码不一致")):i()},trigger:["blur","change"]}]},u=f(),E=f(!1),n=f(0),b=(s,a)=>{s==="email"&&(E.value=a)},q=()=>{n.value=60,h("/api/auth/valid-reset-email",{email:l.email},s=>{d.success(s),setInterval(()=>n.value--,1e3)},s=>{d.warning(s),n.value=0})},z=()=>{u.value.validate(s=>{s?h("/api/auth/start-reset",{email:l.email,code:l.code},()=>{p.value++}):d.warning("请填写电子邮件地址和验证码")})},B=()=>{u.value.validate(s=>{s?h("/api/auth/do-reset",{password:l.password},a=>{d.success(a),j.push("/")}):d.warning("请填写新的密码")})};return(s,a)=>{const i=A,F=U,m=G,_=H,c=J,k=K,v=L,N=M,C=O;return y(),w("div",null,[o("div",Q,[e(F,{active:p.value,"finish-status":"success","align-center":""},{default:t(()=>[e(i,{title:"验证电子邮件"}),e(i,{title:"重新设定密码"})]),_:1},8,["active"])]),e(R,{name:"el-fade-in-linear",mode:"out-in"},{default:t(()=>[p.value===0?(y(),w("div",W,[X,o("div",Y,[e(C,{model:l,rules:V,onValidate:b,ref_key:"formRef",ref:u},{default:t(()=>[e(c,{prop:"email"},{default:t(()=>[e(_,{modelValue:l.email,"onUpdate:modelValue":a[0]||(a[0]=r=>l.email=r),type:"email",placeholder:"电子邮件地址"},{prefix:t(()=>[e(m,null,{default:t(()=>[e(g(P))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{prop:"code"},{default:t(()=>[e(N,{gutter:10,style:{width:"100%"}},{default:t(()=>[e(k,{span:17},{default:t(()=>[e(_,{modelValue:l.code,"onUpdate:modelValue":a[1]||(a[1]=r=>l.code=r),maxlength:6,type:"text",placeholder:"请输入验证码"},{prefix:t(()=>[e(m,null,{default:t(()=>[e(g(D))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(k,{span:5},{default:t(()=>[e(v,{type:"success",onClick:q,disabled:!E.value||n.value>0},{default:t(()=>[x($(n.value>0?"请稍后 "+n.value+" 秒":"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),o("div",Z,[e(v,{onClick:a[2]||(a[2]=r=>z()),style:{width:"270px"},type:"danger",plain:""},{default:t(()=>[x("开始重置密码")]),_:1})])])):I("",!0)]),_:1}),e(R,{name:"el-fade-in-linear",mode:"out-in"},{default:t(()=>[p.value===1?(y(),w("div",ee,[te,o("div",ae,[e(C,{model:l,rules:V,onValidate:b,ref_key:"formRef",ref:u},{default:t(()=>[e(c,{prop:"password"},{default:t(()=>[e(_,{modelValue:l.password,"onUpdate:modelValue":a[3]||(a[3]=r=>l.password=r),maxlength:16,type:"password",placeholder:"新密码"},{prefix:t(()=>[e(m,null,{default:t(()=>[e(g(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{prop:"password_repeat"},{default:t(()=>[e(_,{modelValue:l.password_repeat,"onUpdate:modelValue":a[4]||(a[4]=r=>l.password_repeat=r),maxlength:16,type:"password",placeholder:"重复新密码"},{prefix:t(()=>[e(m,null,{default:t(()=>[e(g(S))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),o("div",le,[e(v,{onClick:a[5]||(a[5]=r=>B()),style:{width:"270px"},type:"danger",plain:""},{default:t(()=>[x("立即重置密码")]),_:1})])])):I("",!0)]),_:1})])}}};export{pe as default};
